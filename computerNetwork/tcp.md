# 可靠数据传输原理
由于底层信道是不可靠的，可能会存在数据包丢失、数据bit翻转，传输大量数据时分包但数据包乱序到达，因此需要一种传输协议进行可靠的数据传输。
## 1.假设底层信道是完全可靠的
发送方接收来自高层的数据，构成一个数据分组然后发送到信道中。  
接收方从信道中收到分组，从分组中取出数据送给高层。  
就像udp那样。
## 2.此时需要确保接收方100%收到了正确的数据
真实的网络环境中，可能因为网络congestion而导致数据包丢失和位翻转。为了解决这个问题，发送方发送一个带有校验机制的数据分组，接收放收到正确数据后给发送方发送一个ACK表示收到了数据，若是不正确的数据则丢弃这个数据并发送一个NACK。  
发送方发送一个数据分组后等待接收方的ACK，收到ACK才会发送下一个数据分组。若收到NACK或者一段时间没收到任何东西，则重新发送上一个数据分组，并等待ACK。这样的等待行为称为停等协议
## 3.当一个完整数据被分为多个数据分组时
当一个完整数据被分为多个数据分组时需要考虑数据的按序接收，因此需要发送方需要给每个数据分组进行编号；接收方需要开辟一定大小的缓存，检查收到的数据的序号并进行排序，并依次将最小序号的数据分组里的数据送给高层。
## 4.减少因为停等所浪费的时间
停等协议因为RTT通常远大于发送方将数据送入信道时间。加入发送方的发送速率为100Mb/s, RTT为30ms。则将1kbit数据发送到信道所用的时间为1000/10^8 = 0.01ms。发送1kbit需要的总时间为0.01ms + 30ms = 30.01ms。停等协议下发送方的利用率只有0.01 / 30.01 = 0.00033。99.97%的时间都浪费在了等ACK。